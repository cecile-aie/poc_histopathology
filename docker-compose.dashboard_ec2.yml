# version: "3.9"

services:
  dashboard:
    build:
      context: .
      dockerfile: Dockerfile.dashboard.ec2
    container_name: p9-dashboard
    restart: unless-stopped
    ports:
      - "8501:8501"

    volumes:
      # Code + notebooks
      - .:/workspace
      # Sorties / artefacts
      - ./outputs:/workspace/outputs
      # ModÃ¨les
      - ./models:/workspace/models
      # DonnÃ©es
      - ./data:/workspace/data
      # ðŸ”¥ Checkpoints (PixCell, etc.)
      - ./checkpoints:/workspace/checkpoints

    env_file:
      - .env
    environment:
      - CUDA_VISIBLE_DEVICES=0
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_SERVER_PORT=8501
      - HF_TOKEN=${HF_TOKEN}
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION:-eu-west-3}
      - S3_BUCKET=p9-histo-data

    gpus: all

